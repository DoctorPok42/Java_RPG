<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ImgMouseControler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Java_RPG</a> &gt; <a href="index.source.html" class="el_package">Class.DevMode.Edit</a> &gt; <span class="el_source">ImgMouseControler.java</span></div><h1>ImgMouseControler.java</h1><pre class="source lang-java linenums">package Class.DevMode.Edit;

import Class.Character.Pnj;
import Class.Character.Roles;
import Class.DevMode.Edit.Utils.ReadItemFile;
import Class.Item.*;
import Class.Map.Map;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import javafx.geometry.Point2D;
import javafx.geometry.Pos;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.StackPane;

import java.io.IOException;
import java.io.Writer;
import java.nio.file.Files;
import java.util.ArrayList;
import java.util.List;

public class ImgMouseControler {
<span class="nc" id="L23">    private final List&lt;ImageView&gt; imgMode = List.of(</span>
            new ImageView(&quot;file:assets/interact/mouse/add.png&quot;),
            new ImageView(&quot;file:assets/interact/mouse/move.png&quot;)
    );
<span class="nc" id="L27">    private int mode = 0;</span>
<span class="nc" id="L28">    private final ImageView bar = new ImageView(&quot;file:assets/interact/mouse/bar.png&quot;);</span>
<span class="nc" id="L29">    private final List&lt;EditItems&gt; allImgItem = List.of(</span>
        new EditItems(new ImageView(&quot;file:assets/items/pc.png&quot;), ItemType.PC, &quot;PC&quot;, 3),
        new EditItems(new ImageView(&quot;file:assets/items/canapplusgros.png&quot;), ItemType.CANAP, &quot;CANAP&quot;, 1),
        new EditItems(new ImageView(&quot;file:assets/items/canapplusgros2.png&quot;), ItemType.CANAP, &quot;CANAP&quot;, 2),
        new EditItems(new ImageView(&quot;file:assets/items/distributeur.png&quot;), ItemType.DISTRIBUTOR, &quot;DISTRIBUTOR&quot;, 0),
        new EditItems(new ImageView(&quot;file:assets/items/table3.png&quot;), ItemType.TABLE, &quot;Table&quot;, 3),
        new EditItems(new ImageView(&quot;file:assets/items/table5.png&quot;), ItemType.TABLE, &quot;Table&quot;, 5),
        new EditItems(new ImageView(&quot;file:assets/Pnjs/skin1/AnimSkin1-0.png&quot;), ItemType.PNJ, &quot;PNJ&quot;, 1),
        new EditItems(new ImageView(&quot;file:assets/Pnjs/skin2/AnimSkin2-0.png&quot;), ItemType.PNJ, &quot;PNJ&quot;, 2),
        new EditItems(new ImageView(&quot;file:assets/Pnjs/skin3/AnimSkin3-0.png&quot;), ItemType.PNJ, &quot;PNJ&quot;, 3)
    );
<span class="nc" id="L40">    private final ImageView imgSelected = new ImageView(&quot;file:assets/interact/mouse/selected.png&quot;);</span>
<span class="nc" id="L41">    private int selected = 0;</span>
<span class="nc" id="L42">    private final ImageView itemToDisplay = new ImageView();</span>
    private final ReadItemFile readItemFile;
<span class="nc" id="L44">    private List&lt;Item&gt; itemField = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L46">    public ImgMouseControler(String filePath) throws IOException {</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">        for (ImageView img : imgMode) {</span>
<span class="nc" id="L48">            img.setFitWidth(20);</span>
<span class="nc" id="L49">            img.setFitHeight(20);</span>
<span class="nc" id="L50">        }</span>

<span class="nc" id="L52">        StackPane.setAlignment(bar, Pos.BOTTOM_LEFT);</span>

<span class="nc" id="L54">        int i = 0;</span>

<span class="nc bnc" id="L56" title="All 2 branches missed.">        for (ImageView img : EditItems.getAllItemsView()) {</span>
<span class="nc" id="L57">            img.setFitWidth(40);</span>
<span class="nc" id="L58">            img.setFitHeight(40);</span>

<span class="nc" id="L60">            StackPane.setAlignment(img, Pos.BOTTOM_CENTER);</span>
<span class="nc" id="L61">            img.setTranslateX(</span>
                    // positionner les items au centre de l'écran en les décalant de 20px chacun
<span class="nc" id="L63">                    (-allImgItem.size() * 20 + (40 * i * 2)) - ((double) 720 / allImgItem.size())</span>
            );
<span class="nc" id="L65">            img.setTranslateY(-20);</span>
<span class="nc" id="L66">            i++;</span>
<span class="nc" id="L67">        }</span>

<span class="nc" id="L69">        StackPane.setAlignment(imgSelected, Pos.BOTTOM_CENTER);</span>
<span class="nc" id="L70">        imgSelected.setTranslateX((-allImgItem.size() * 20) - ((double) 720 / allImgItem.size()));</span>
<span class="nc" id="L71">        imgSelected.setTranslateY(-9);</span>

<span class="nc" id="L73">        readItemFile = new ReadItemFile(filePath);</span>
<span class="nc" id="L74">        this.itemField = readItemFile.readItems(new GsonBuilder().registerTypeAdapter(Item.class, new ItemTypeAdapter()).create());</span>
<span class="nc" id="L75">    }</span>

    public int getMode() {
<span class="nc" id="L78">        return mode;</span>
    }

    public int getSelected() {
<span class="nc" id="L82">        return selected;</span>
    }

    public List&lt;ImageView&gt; getAllImgItem() {
<span class="nc" id="L86">        return EditItems.getAllItemsView();</span>
    }

    public void changeSelected(int selected) {
<span class="nc" id="L90">        this.selected = selected;</span>

<span class="nc" id="L92">        imgSelected.setTranslateX((-allImgItem.size() * 20 + (40 * selected * 2)) - ((double) 720 / allImgItem.size()));</span>
<span class="nc" id="L93">    }</span>

    public void setMode(int mode, StackPane gameView) {
<span class="nc" id="L96">        this.mode = mode;</span>

<span class="nc bnc" id="L98" title="All 2 branches missed.">        for (int i = 0; i &lt; imgMode.size(); i++) {</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">            if (i != mode) {</span>
<span class="nc" id="L100">                gameView.getChildren().remove(imgMode.get(i));</span>
<span class="nc" id="L101">                gameView.getChildren().remove(bar);</span>

<span class="nc bnc" id="L103" title="All 2 branches missed.">                for (ImageView img : EditItems.getAllItemsView()) {</span>
<span class="nc" id="L104">                    gameView.getChildren().remove(img);</span>
<span class="nc" id="L105">                }</span>

<span class="nc" id="L107">                gameView.getChildren().remove(imgSelected);</span>

<span class="nc" id="L109">                gameView.getChildren().remove(itemToDisplay);</span>
            }
        }
<span class="nc" id="L112">    }</span>

    public void displayItemSelected(double x, double y, StackPane gameView) {
<span class="nc" id="L115">        double fx = x - gameView.getWidth() / 2;</span>
<span class="nc" id="L116">        double fy = y - gameView.getHeight() / 2;</span>

<span class="nc" id="L118">        gameView.getChildren().remove(itemToDisplay);</span>

<span class="nc" id="L120">        itemToDisplay.setImage(allImgItem.get(selected).getImg().getImage());</span>
<span class="nc" id="L121">        itemToDisplay.setTranslateX(fx);</span>
<span class="nc" id="L122">        itemToDisplay.setTranslateY(fy);</span>

<span class="nc" id="L124">        itemToDisplay.setOpacity(0.7);</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">        if (!gameView.getChildren().contains(itemToDisplay))</span>
<span class="nc" id="L127">            gameView.getChildren().add(itemToDisplay);</span>
<span class="nc" id="L128">    }</span>

    public void putItem(Map map, Point2D clickPoint) {
<span class="nc" id="L131">        Gson gson = new GsonBuilder().registerTypeAdapter(Item.class, new ItemTypeAdapter()).setPrettyPrinting().create();</span>

        try {
<span class="nc" id="L134">            List&lt;Item&gt; itemList = this.itemField;</span>

<span class="nc" id="L136">            int lastId = 0;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">            if (!itemList.isEmpty()) {</span>
<span class="nc" id="L138">                lastId = itemList.getLast().getId();</span>
            }

<span class="nc" id="L141">            double itemX = clickPoint.getX() - itemToDisplay.getImage().getWidth() / 2;</span>
<span class="nc" id="L142">            double itemY = clickPoint.getY() - itemToDisplay.getImage().getHeight() / 2;</span>

<span class="nc" id="L144">            Item item = new Item(allImgItem.get(selected).getName(), allImgItem.get(selected).getType(), (float) itemX, (float) itemY, 1, allImgItem.get(selected).getSkin(), lastId + 1);</span>
<span class="nc" id="L145">            itemList.add(item);</span>

<span class="nc" id="L147">            Writer writer = Files.newBufferedWriter(readItemFile.getItemFilePath());</span>
<span class="nc" id="L148">            gson.toJson(itemList, writer);</span>
<span class="nc" id="L149">            writer.close();</span>

<span class="nc" id="L151">            Item items =</span>
<span class="nc bnc" id="L152" title="All 6 branches missed.">                    switch ((ItemType) item.getType()) {</span>
<span class="nc" id="L153">                        case PC -&gt; new Pc(item.getName(), item.getType(), item.getX(), item.getY(), item.getZ(), item.getSkin(), lastId + 1);</span>
<span class="nc" id="L154">                        case CANAP -&gt; new Canap(item.getName(), item.getType(), item.getX(), item.getY(), item.getZ(), item.getSkin(), lastId + 1);</span>
<span class="nc" id="L155">                        case DISTRIBUTOR -&gt; new Distributor(item.getName(), item.getType(), item.getX(), item.getY(), item.getZ(), 0, item.getSkin(), lastId + 1);</span>
<span class="nc" id="L156">                        case TABLE -&gt; new Item(item.getName(), item.getType(), item.getX(), item.getY(), item.getZ(), item.getSkin(), lastId + 1);</span>
<span class="nc" id="L157">                        case PNJ -&gt; new PnjInteraction(item.getName(), item.getType(), item.getX(), item.getY(), item.getZ(), item.getSkin(), null, lastId + 1);</span>
                    };

<span class="nc" id="L160">            map.getItems().add(items);</span>
<span class="nc" id="L161">            map.getItems().getLast().getItemView().toFront();</span>

<span class="nc" id="L163">            map.getMapContainer().getChildren().add(items.getInteractionHitbox());</span>
<span class="nc" id="L164">            map.getMapContainer().getChildren().add(items.getHitbox());</span>

<span class="nc" id="L166">            items.getItemView().setLayoutX(itemX);</span>
<span class="nc" id="L167">            items.getItemView().setLayoutY(itemY);</span>

<span class="nc bnc" id="L169" title="All 2 branches missed.">            if (items.getType() == ItemType.PNJ) {</span>
<span class="nc" id="L170">                Pnj pnj = new Pnj(&quot;Pnj&quot;, Roles.PEDAGO, item.getSkin(), items.getX(), items.getY(), lastId + 1);</span>
<span class="nc" id="L171">                map.getObstacles().add(pnj.getPnjHitbox());</span>
<span class="nc" id="L172">                pnj.getCharacView().setLayoutX(pnj.getPosX());</span>
<span class="nc" id="L173">                pnj.getCharacView().setLayoutY(pnj.getPosY());</span>
<span class="nc" id="L174">                map.getMapContainer().getChildren().add(pnj.getCharacView());</span>
            }

<span class="nc" id="L177">            map.getMapContainer().getChildren().add(items.getItemView());</span>
<span class="nc" id="L178">        } catch (Exception ex) {</span>
<span class="nc" id="L179">            ex.printStackTrace();</span>
<span class="nc" id="L180">        }</span>
<span class="nc" id="L181">    }</span>

    private void actionOnAdd(double x, double y, StackPane gameView) {
<span class="nc bnc" id="L184" title="All 2 branches missed.">        if (!gameView.getChildren().contains(bar))</span>
<span class="nc" id="L185">            gameView.getChildren().add(bar);</span>

<span class="nc bnc" id="L187" title="All 2 branches missed.">        for (ImageView img : EditItems.getAllItemsView()) {</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">            if (!gameView.getChildren().contains(img))</span>
<span class="nc" id="L189">                gameView.getChildren().add(img);</span>
<span class="nc" id="L190">        }</span>

<span class="nc bnc" id="L192" title="All 2 branches missed.">        if (!gameView.getChildren().contains(imgSelected))</span>
<span class="nc" id="L193">            gameView.getChildren().add(imgSelected);</span>

<span class="nc" id="L195">        displayItemSelected(x, y, gameView);</span>
<span class="nc" id="L196">    }</span>

    public void displayImg(double x, double y, StackPane gameView, Map map, Replace replace) {
<span class="nc" id="L199">        double fx = x - gameView.getWidth() / 2;</span>
<span class="nc" id="L200">        double fy = y - gameView.getHeight() / 2;</span>
<span class="nc" id="L201">        imgMode.get(mode).setTranslateX(fx + 10);</span>
<span class="nc" id="L202">        imgMode.get(mode).setTranslateY(fy -10);</span>

<span class="nc" id="L204">        Point2D mouse = map.getMapContainer().sceneToLocal(x, y);</span>

<span class="nc bnc" id="L206" title="All 2 branches missed.">        if (!gameView.getChildren().contains(imgMode.get(mode)))</span>
<span class="nc" id="L207">            gameView.getChildren().add(imgMode.get(mode));</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">        if (mode == 0) {</span>
<span class="nc" id="L210">            actionOnAdd(x, y, gameView);</span>
<span class="nc bnc" id="L211" title="All 2 branches missed.">        } else if (mode == 1) {</span>
<span class="nc" id="L212">            replace.move(map, mouse);</span>
        }
<span class="nc" id="L214">    }</span>

    public void removeImg(StackPane gameView) {
<span class="nc" id="L217">        gameView.getChildren().remove(imgMode.get(mode));</span>
<span class="nc" id="L218">        gameView.getChildren().remove(bar);</span>

<span class="nc bnc" id="L220" title="All 2 branches missed.">        for (ImageView img : EditItems.getAllItemsView()) {</span>
<span class="nc" id="L221">            gameView.getChildren().remove(img);</span>
<span class="nc" id="L222">        }</span>

<span class="nc" id="L224">        gameView.getChildren().remove(imgSelected);</span>

<span class="nc" id="L226">        gameView.getChildren().remove(itemToDisplay);</span>
<span class="nc" id="L227">    }</span>

    public void setItemField(List&lt;Item&gt; itemField) {
<span class="nc" id="L230">        this.itemField = itemField;</span>
<span class="nc" id="L231">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>