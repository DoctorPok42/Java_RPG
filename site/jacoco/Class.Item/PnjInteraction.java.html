<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PnjInteraction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Java_RPG</a> &gt; <a href="index.source.html" class="el_package">Class.Item</a> &gt; <span class="el_source">PnjInteraction.java</span></div><h1>PnjInteraction.java</h1><pre class="source lang-java linenums">package Class.Item;

import Class.Character.Player;
import Class.Character.Pnj;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import javafx.geometry.Pos;
import javafx.scene.image.Image;
import javafx.scene.input.KeyCode;
import javafx.scene.input.KeyEvent;
import javafx.scene.shape.Rectangle;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.image.ImageView;
import javafx.scene.layout.HBox;
import javafx.scene.layout.StackPane;
import javafx.scene.layout.VBox;
import javafx.scene.paint.ImagePattern;
import javafx.scene.text.Font;
import javafx.scene.text.Text;

import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

public class PnjInteraction extends Item{
    Pnj pnj;
<span class="nc" id="L29">    private final Font font = Font.loadFont(&quot;file:assets/font/PressStart2P-Regular.ttf&quot;, 20);</span>
    private int id;

    public PnjInteraction (String name, Enum&lt;ItemType&gt; type, float x, float y, int z, int skin, Pnj pnj, int id) {
<span class="nc" id="L33">        super(name, type, x, y, z, skin, id);</span>
<span class="nc" id="L34">        this.pnj = pnj;</span>
<span class="nc" id="L35">        this.id = id;</span>
<span class="nc" id="L36">        this.menu.add(new ImageView(&quot;file:assets/interact/pnj/speak.png&quot;));</span>

<span class="nc bnc" id="L38" title="All 2 branches missed.">        for (ImageView img : this.menu) {</span>
<span class="nc" id="L39">            img.setFitWidth(83.6);</span>
<span class="nc" id="L40">            img.setFitHeight(32);</span>
<span class="nc" id="L41">        }</span>
<span class="nc" id="L42">        this.second_menu.add(null);</span>
<span class="nc" id="L43">    }</span>
    public Pnj getPnj() {
<span class="nc" id="L45">        return this.pnj;</span>
    }
    private void displayDiaglogBox(StackPane gameView) {

<span class="nc" id="L49">        Dialogues[] dialogues = null;</span>
<span class="nc" id="L50">        List&lt;Dialogues&gt; pnjDialogues = null;</span>
<span class="nc" id="L51">        try (FileReader reader = new FileReader(&quot;./data/Dialogues.json&quot;)) {</span>
<span class="nc" id="L52">            Gson gson = new GsonBuilder().registerTypeAdapter(Dialogues.class, new DialoguesTypeApadter()).create();</span>
<span class="nc" id="L53">             dialogues = gson.fromJson(reader, Dialogues[].class);</span>
<span class="nc" id="L54">             pnjDialogues = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L55" title="All 2 branches missed.">             for (Dialogues d : dialogues) {</span>
<span class="nc bnc" id="L56" title="All 4 branches missed.">                 if (d.getName()!=null &amp;&amp; d.getName().equals(this.pnj.getName())) {</span>
<span class="nc" id="L57">                     pnjDialogues.add(d);</span>
                 }
             }
<span class="nc" id="L60">        } catch (IOException e) {</span>
<span class="nc" id="L61">            e.printStackTrace();</span>
<span class="nc" id="L62">        }</span>

<span class="nc" id="L64">        VBox dialogBox = new VBox();</span>
<span class="nc" id="L65">        int idDialogue = 0;</span>
<span class="nc" id="L66">        dialogBox.setAlignment(Pos.BOTTOM_CENTER);</span>
<span class="nc" id="L67">        dialogBox.setId(&quot;dialogBox&quot;);</span>
<span class="nc" id="L68">        dialogBox.setSpacing(10);</span>
<span class="nc" id="L69">        Label dialog = new Label(pnjDialogues.get(idDialogue).getText());</span>
<span class="nc" id="L70">        dialog.setStyle(&quot;-fx-font-size: 10;&quot; +</span>
                &quot;-fx-font-fill: white ;&quot; +
                &quot;-fx-font-family: 'Press Start 2P';&quot;
        );
<span class="nc" id="L74">        dialogBox.setStyle(&quot;-fx-font-family: 'Press Start 2P';&quot; +</span>
                &quot;-fx-background-color: rgba(0, 0, 0, 0.2);&quot;

        );
<span class="nc" id="L78">        dialog.setWrapText(true);</span>
<span class="nc" id="L79">        dialog.setAlignment(Pos.CENTER);</span>

<span class="nc" id="L81">        int nbLines = dialog.getText().split(&quot;\n&quot;).length;</span>
<span class="nc" id="L82">        dialog.setLineSpacing(5);</span>

<span class="nc" id="L84">        HBox pnjdialog = new HBox();</span>
<span class="nc" id="L85">        Rectangle rect = new Rectangle(520, 101);</span>
<span class="nc" id="L86">        rect.setFill(new ImagePattern(new Image(getClass().getResource(&quot;/assets/pnj/dialogbox5.png&quot;).toExternalForm())));</span>
<span class="nc" id="L87">        StackPane background = new StackPane(rect);</span>
<span class="nc" id="L88">        pnjdialog.getChildren().add(background);</span>
<span class="nc" id="L89">        pnjdialog.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L90">        pnjdialog.setSpacing(10);</span>
<span class="nc" id="L91">        background.getChildren().add(dialog);</span>

<span class="nc" id="L93">        HBox responses = new HBox();</span>
<span class="nc" id="L94">        responses.setSpacing(20);</span>
<span class="nc" id="L95">        responses.setAlignment(Pos.CENTER);</span>
<span class="nc" id="L96">        Button resp1 = new Button(pnjDialogues.get(pnjDialogues.get(0).getChoices().get(0)).getText());</span>
<span class="nc" id="L97">        Rectangle resp1rect = new Rectangle(250, 48);</span>
<span class="nc" id="L98">        resp1rect.setFill(new ImagePattern(new Image(getClass().getResource(&quot;/assets/pnj/dialogbox3.png&quot;).toExternalForm())));</span>
<span class="nc" id="L99">        StackPane resp1background = new StackPane(resp1rect);</span>
<span class="nc" id="L100">        resp1.setStyle(&quot;-fx-font-family: 'Press Start 2P';-fx-font-fill: white; -fx-font-size: 10;-fx-background-color: transparent;&quot;);</span>
<span class="nc" id="L101">        resp1background.getChildren().add(resp1);</span>

<span class="nc" id="L103">        Button resp2 = new Button(pnjDialogues.get(pnjDialogues.get(idDialogue).getChoices().get(1)).getText());</span>
<span class="nc" id="L104">        Rectangle resp2rect = new Rectangle(250, 48);</span>
<span class="nc" id="L105">        resp2rect.setFill(new ImagePattern(new Image(getClass().getResource(&quot;/assets/pnj/dialogbox3.png&quot;).toExternalForm())));</span>
<span class="nc" id="L106">        StackPane resp2background = new StackPane(resp2rect);</span>
<span class="nc" id="L107">        resp2.setStyle(&quot;-fx-font-family: 'Press Start 2P';-fx-font-fill: white; -fx-font-size: 10;-fx-background-color: transparent;&quot;);</span>
<span class="nc" id="L108">        resp2background.getChildren().add(resp2);</span>

<span class="nc" id="L110">        responses.getChildren().addAll(resp1background, resp2background);</span>

<span class="nc" id="L112">        updateDialogBox(pnjDialogues.get(idDialogue), dialog, resp1, resp2, pnjDialogues, gameView, rect);</span>
<span class="nc" id="L113">        dialogBox.getChildren().addAll(pnjdialog, responses);</span>
<span class="nc" id="L114">        gameView.getChildren().add(dialogBox);</span>
<span class="nc" id="L115">    }</span>

    private void updateDialogBox(Dialogues currentDialogue, Label pnjDialogue, Button resp1, Button resp2, List&lt;Dialogues&gt; pnjDialogues, StackPane gameView, Rectangle rect) {
<span class="nc" id="L118">        int nbLines = pnjDialogue.getText().split(&quot;\n&quot;).length;</span>
<span class="nc" id="L119">        pnjDialogue.setLineSpacing(5 - (nbLines - 3));</span>

<span class="nc" id="L121">        resp1.setOnAction(e -&gt; {</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">            if (pnjDialogues.get(currentDialogue.getChoices().get(0)).getChoices().size() != 0){</span>
<span class="nc" id="L123">                pnjDialogue.setText(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(0)).getChoices().get(0)).getText());</span>
<span class="nc" id="L124">                resp1.setText(pnjDialogues.get(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(0)).getChoices().get(0)).getChoices().get(0)).getText());</span>
<span class="nc" id="L125">                resp2.setText(pnjDialogues.get(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(0)).getChoices().get(0)).getChoices().get(1)).getText());</span>
<span class="nc" id="L126">                updateDialogBox(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(0)).getChoices().get(0)), pnjDialogue, resp1, resp2, pnjDialogues, gameView, rect);</span>
            }else{
<span class="nc" id="L128">                gameView.getOnKeyPressed().handle(new KeyEvent(</span>
                        KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.ESCAPE, false, false, false, false
                ));
            }
<span class="nc" id="L132">        });</span>

<span class="nc" id="L134">        resp2.setOnAction(e -&gt; {</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">            if (pnjDialogues.get(currentDialogue.getChoices().get(1)).getChoices().size() != 0){</span>
<span class="nc" id="L136">                pnjDialogue.setText(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(1)).getChoices().get(0)).getText());</span>
<span class="nc" id="L137">                resp1.setText(pnjDialogues.get(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(1)).getChoices().get(0)).getChoices().get(0)).getText());</span>
<span class="nc" id="L138">                resp2.setText(pnjDialogues.get(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(1)).getChoices().get(0)).getChoices().get(1)).getText());</span>
<span class="nc" id="L139">                updateDialogBox(pnjDialogues.get(pnjDialogues.get(currentDialogue.getChoices().get(1)).getChoices().get(0)), pnjDialogue, resp1, resp2, pnjDialogues, gameView, rect);</span>
            }else{
<span class="nc" id="L141">                gameView.getOnKeyPressed().handle(new KeyEvent(</span>
                        KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCode.ESCAPE, false, false, false, false
                ));
            }
<span class="nc" id="L145">        });</span>

<span class="nc" id="L147">    }</span>

    public boolean speak(Player player , Pnj pnj, StackPane gameView) {
<span class="nc" id="L150">        displayDiaglogBox(gameView);</span>
<span class="nc" id="L151">        return  true;</span>
        }
    public boolean doAction(Player player, Enum&lt;?&gt; action, Pnj pnj, StackPane gameView) {
<span class="nc bnc" id="L154" title="All 2 branches missed.">        if(!(action instanceof PnjTypeAction))</span>
<span class="nc" id="L155">            return false;</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">        return switch ((PnjTypeAction) action) {</span>
<span class="nc" id="L157">            case SPEAK -&gt; speak(player, pnj, gameView);</span>
        };
    }
    @Override
    public List&lt;PnjTypeAction&gt; getActions() {
<span class="nc" id="L162">        return List.of(PnjTypeAction.class.getEnumConstants());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>